{% extends "base.html" %}

{% block title %}TrÃ¬nh Xá»­ LÃ½ áº¢nh Äa Chá»©c NÄƒng{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">ğŸ§  TrÃ¬nh Xá»­ LÃ½ áº¢nh</h2>

    <form method="POST" enctype="multipart/form-data" class="card p-4 shadow-sm">
        <!-- 1. Chá»n cháº¿ Ä‘á»™ -->
        <div class="mb-3">
            <label for="mode" class="form-label">ğŸ§° Chá»n chá»©c nÄƒng:</label>
            <select name="mode" id="mode" class="form-select" required onchange="onModeChange(this.value)">
                <option value="" disabled selected>-- Chá»n má»™t chá»©c nÄƒng --</option>
                <option value="text2image">âœï¸ VÄƒn báº£n â†’ áº¢nh</option>
                <option value="edit">ğŸ› ï¸ Chá»‰nh sá»­a áº£nh</option>
                <option value="transform">ğŸ”„ Biáº¿n Ä‘á»•i áº£nh</option>
            </select>
        </div>

        <!-- 2. Engine (tÃ¹y vÃ o mode) -->
        <div class="mb-3">
            <label for="tool" class="form-label">âš™ï¸ CÃ´ng cá»¥:</label>
            <select name="tool" id="tool" class="form-select" required>
                <!-- Sáº½ cáº­p nháº­t qua JS tÆ°Æ¡ng á»©ng vá»›i mode -->
            </select>
        </div>

        <!-- 3. Input khÃ¡c tÃ¹y theo cháº¿ Ä‘á»™ -->
        <div id="mode-inputs">
            <!-- placeholder cho pháº§n input Ä‘á»™ng -->
        </div>

        <button type="submit" class="btn btn-primary">ğŸš€ Xá»­ lÃ½</button>
    </form>

    {% if generated_image_url %}
    <div class="mt-5">
        <h4>âœ… Káº¿t quáº£:</h4>
        <img src="{{ generated_image_url }}" alt="áº¢nh Ä‘Ã£ táº¡o" class="img-fluid border rounded shadow-sm">
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
function onModeChange(mode) {
    const toolSelect = document.getElementById("tool");
    const inputArea = document.getElementById("mode-inputs");

    // Reset
    toolSelect.innerHTML = '';
    inputArea.innerHTML = '';

if (mode === "text2image") {
    toolSelect.innerHTML = `
        <option value="stability">ğŸŒŒ Stable Diffusion (Stability.ai)</option>
        <option value="gan">ğŸ¤– StyleGAN</option>
    `;
    inputArea.innerHTML = `
        <div class="mb-3">
            <label for="description" class="form-label">ğŸ“ MÃ´ táº£:</label>
            <textarea class="form-control" name="description" rows="4" placeholder="VÃ­ dá»¥: Má»™t con rá»“ng trÃªn máº·t trÄƒng" required></textarea>
            <small class="text-muted">âš ï¸ MÃ´ táº£ chá»‰ há»— trá»£ tiáº¿ng Anh (vÃ­ dá»¥: "a dragon flying over the moon")</small>

        </div>
    `;
} else if (mode === "edit") {
        toolSelect.innerHTML = `
            <option value="pillow">ğŸ§µ Pillow</option>
            <option value="opencv">ğŸ“· OpenCV</option>
        `;
        inputArea.innerHTML = `
            <div class="mb-3">
                <label for="image" class="form-label">ğŸ“¤ Táº£i áº£nh lÃªn:</label>
                <input type="file" name="image" class="form-control" accept="image/*" required>
            </div>
            <div class="mb-3">
                <label for="edit_action" class="form-label">âœ‚ï¸ HÃ nh Ä‘á»™ng:</label>
                <select name="edit_action" class="form-select">
                    <option value="grayscale">LÃ m Ä‘en tráº¯ng</option>
                    <option value="blur">LÃ m má»</option>
                    <option value="invert">Äáº£o mÃ u</option>
                </select>
            </div>
        `;
    } else if (mode === "transform") {
        toolSelect.innerHTML = `
            <option value="matplotlib">ğŸ“Š Matplotlib</option>
            <option value="scikit">ğŸ§ª Scikit-Image</option>
        `;
        inputArea.innerHTML = `
            <div class="mb-3">
                <label class="form-label">ğŸ’¡ Biáº¿n Ä‘á»•i máº«u:</label>
                <input type="text" name="transform_param" class="form-control" placeholder="VÃ­ dá»¥: sin(x) * cos(y)">
            </div>
        `;
    }
}
</script>
{% endblock %}

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>üìÇ Danh s√°ch Media</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Plyr CSS -->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <style>
        video, audio {
            width: 100%;
            max-height: 360px;
        }
        video.plyr__video-embed,
        video.plyr__video {
        width: 100%;
        height: auto; /* nh∆∞ng JS s·∫Ω override chi·ªÅu cao ƒë√∫ng t·ªâ l·ªá */
        }
    </style>
</head>
<body class="bg-light">
<div class="container mt-5">
    <h2 class="text-center mb-4">üìÇ Danh s√°ch c√°c file Audio & Video</h2>

    {% if audio_files %}
        <h4>üéµ Audio:</h4>
        <ul class="list-group mb-4">
            {% for file in audio_files %}
                <li class="list-group-item">
                    <strong>{{ file }}</strong><br>
                    <audio class="plyr" controls>
                        <source src="{{ url_for('audio_tools.serve_media', media_type='audio', filename=file) }}">
                    </audio>
                    <div class="mt-2">
                        <a href="{{ url_for('audio_tools.serve_media', media_type='audio', filename=file) }}" class="btn btn-sm btn-success" download>‚¨áÔ∏è T·∫£i</a>
                    </div>
                </li>
            {% endfor %}
        </ul>
    {% endif %}

    {% if video_files %}
        <h4>üé• Video:</h4>
        <ul class="list-group">
            {% for file in video_files %}
                <li class="list-group-item">
                    <strong>{{ file }}</strong><br>
                    <video class="plyr" controls>
                        <source src="{{ url_for('audio_tools.serve_media', media_type='video', filename=file) }}">
                        
                        {# N·∫øu b·∫°n c√≥ ph·ª• ƒë·ªÅ .vtt c√πng t√™n file th√¨ c√≥ th·ªÉ th√™m ƒëo·∫°n sau: #}
                        {% set base = file.rsplit('.', 1)[0] %}
                        {% if base ~ '.vtt' in subtitle_files %}
                            <track kind="subtitles" src="{{ url_for('audio_tools.serve_media', media_type='subtitle', filename=base ~ '.vtt') }}" srclang="vi" label="Ti·∫øng Vi·ªát" default>
                        {% endif %}
                    </video>
                    <div class="mt-2">
                        <a href="{{ url_for('audio_tools.serve_media', media_type='video', filename=file) }}" class="btn btn-sm btn-primary" download>‚¨áÔ∏è T·∫£i</a>
                    </div>
                </li>
            {% endfor %}
        </ul>
    {% endif %}

    {% if not audio_files and not video_files %}
        <p class="text-muted text-center">Kh√¥ng c√≥ file audio ho·∫∑c video n√†o.</p>
    {% endif %}
</div>

<!-- Plyr JS -->
<script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    Plyr.setup('.plyr', {
        controls: [
            'play-large',
            'rewind',
            'play',
            'fast-forward',
            'progress',
            'current-time',
            'duration',
            'mute',
            'volume',
            'captions',
            'settings',
            'download',
            'pip',
            'fullscreen'
        ],
        settings: ['captions', 'quality', 'speed', 'loop'],
        speed: {
            selected: 1,
            options: [0.25, 0.5, 0.75, 1, 1.25, 1.5, 2]
        },
        tooltips: {
            controls: true,
            seek: true
        },
        keyboard: {
            focused: true,
            global: false
        },
        clickToPlay: true,
        previewThumbnails: {
            enabled: true,  // N·∫øu b·∫°n c·∫•u h√¨nh ·∫£nh thumbnail ri√™ng
        },
        fullscreen: {
            enabled: true,
            fallback: true,
            iosNative: false
        },
        // ratio: '16:9',
    });
});

  players.forEach(player => {
    const video = player.elements.container.querySelector('video');
    if (video) {
      video.addEventListener('loadedmetadata', () => {
        const aspectRatio = video.videoWidth / video.videoHeight;
        const width = video.clientWidth;
        const height = width / aspectRatio;
        video.style.height = `${height}px`;
        player.elements.container.style.height = `${height}px`;
      });
    }
  });
</script>
</body>
</html>

{% extends "base.html" %}
{% block title %}KÃªnh YouTube ÄÃ£ Káº¿t Ná»‘i{% endblock %}

{% block content %}
<h2 class="text-center mb-4">ğŸ“º KÃªnh YouTube ÄÃ£ Káº¿t Ná»‘i</h2>

<!-- NÃºt má»Ÿ popup -->
<div class="mb-3 text-end">
    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#connectModal">
        ğŸ”— Káº¿t ná»‘i kÃªnh má»›i
    </button>
</div>

<!-- Danh sÃ¡ch kÃªnh -->
<div class="row g-4">
    {% for channel in channels %}
    <div class="col-md-4">
        <div class="card shadow-sm h-100">
<div class="card-body text-center">
    <img src="{{ channel.thumbnail_url }}" class="rounded-circle mb-3" width="80" height="80">
    <h5 class="card-title">{{ channel.title }}</h5>
    <p class="text-muted small">ID: {{ channel.channel_id }}</p>

    <!-- ThÃªm thÃ´ng tin chi tiáº¿t -->
    <ul class="list-unstyled mb-2 small text-start">
        <li><strong>ğŸ‘¥ Sub:</strong> {{ channel.subscribers | default('N/A') }}</li>
        <li><strong>ğŸ‘ï¸ Views:</strong> {{ channel.views | default('N/A') }}</li>
        <li><strong>ğŸŒ Quá»‘c gia:</strong> {{ channel.country | default('KhÃ´ng rÃµ') }}</li>
        <li><strong>ğŸ“… Táº¡o:</strong>
            {{ channel.published_at[:10] if channel.published_at else 'KhÃ´ng rÃµ' }}
        </li>
    </ul>

<a href="{{ url_for('social.manage_videos', channel_id=channel.id) }}" class="btn btn-outline-primary btn-sm me-2">ğŸ“¤ Video</a>
<a href="{{ url_for('social.manage_posts', channel_id=channel.id) }}" class="btn btn-outline-secondary btn-sm">ğŸ“ BÃ i viáº¿t</a>
<!-- NÃºt má»Ÿ modal upload video -->
<button class="btn btn-outline-success btn-sm mt-2" data-bs-toggle="modal" data-bs-target="#uploadModal{{ channel.id }}">
    ğŸ“¤ Upload Video
</button>
<!-- Modal Upload Video cho channel -->
<div class="modal fade" id="uploadModal{{ channel.id }}" tabindex="-1" aria-labelledby="uploadModalLabel{{ channel.id }}" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form method="POST" action="{{ url_for('social.upload_video') }}" enctype="multipart/form-data">
        <div class="modal-header">
          <h5 class="modal-title" id="uploadModalLabel{{ channel.id }}">ğŸ“¤ Upload video cho kÃªnh {{ channel.title }}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ÄÃ³ng"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="channel_id" value="{{ channel.id }}">

          <div class="mb-3">
            <label class="form-label">TiÃªu Ä‘á»</label>
            <input type="text" name="title" class="form-control" required>
          </div>

          <div class="mb-3">
            <label class="form-label">MÃ´ táº£</label>
            <textarea name="description" class="form-control" rows="3"></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label">Tags (phÃ¢n cÃ¡ch báº±ng dáº¥u pháº©y)</label>
            <input type="text" name="tags" class="form-control">
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Thá»ƒ loáº¡i (Topic)</label>
              <select name="topic_id" class="form-select">
                <option value="">-- KhÃ´ng chá»n --</option>
                {% for topic in topics %}
                <option value="{{ topic.id }}">{{ topic.name }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="col-md-3 mb-3">
              <label class="form-label">Loáº¡i video</label>
              <select name="video_type" class="form-select">
                <option value="long">ğŸ¥ Long</option>
                <option value="short">ğŸ“± Short</option>
              </select>
            </div>

            <div class="col-md-3 mb-3">
              <label class="form-label">Cháº¿ Ä‘á»™</label>
              <select name="privacy_status" class="form-select">
                <option value="private">ğŸ”’ Private</option>
                <option value="unlisted">ğŸ”— Unlisted</option>
                <option value="public">ğŸŒ Public</option>
              </select>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Thá»i gian Ä‘Äƒng (tuá»³ chá»n)</label>
            <input type="datetime-local" name="scheduled_time" class="form-control">
          </div>

          <div class="mb-3">
            <label class="form-label">Chá»n file video</label>
            <input type="file" name="video_file" class="form-control" accept="video/*" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Thumbnail (tuá»³ chá»n)</label>
            <input type="file" name="thumbnail_file" class="form-control" accept="image/*">
          </div>

        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">ğŸ“¤ LÃªn lá»‹ch Ä‘Äƒng</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Huá»·</button>
        </div>
      </form>
    </div>
  </div>
</div>

    <form method="POST" action="{{ url_for('social.delete_youtube_channel', channel_id=channel.channel_id) }}" onsubmit="return confirm('Báº¡n cÃ³ cháº¯c muá»‘n xoÃ¡ kÃªnh nÃ y?');">
        <button type="submit" class="btn btn-outline-danger btn-sm mt-2">âŒ Gá»¡ kÃªnh</button>
    </form>
</div>

        </div>
    </div>
    {% endfor %}
</div>

<!-- Modal Popup -->
<div class="modal fade" id="connectModal" tabindex="-1" aria-labelledby="connectModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="POST" action="{{ url_for('social.connect_youtube_form') }}" enctype="multipart/form-data">
        <div class="modal-header">
          <h5 class="modal-title" id="connectModalLabel">ğŸ”— Káº¿t ná»‘i kÃªnh YouTube má»›i</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ÄÃ³ng"></button>
        </div>
        <div class="modal-body">
          <!-- Lá»±a chá»n phÆ°Æ¡ng thá»©c káº¿t ná»‘i -->
          <div class="mb-3">
            <label class="form-label">Chá»n cÃ¡ch káº¿t ná»‘i:</label>
            <select class="form-select" id="authMethod" name="auth_method" required onchange="toggleAuthMethod()">
              <option value="manual">ğŸ”‘ Nháº­p Client ID & Secret</option>
              <option value="file">ğŸ“ Upload file JSON</option>
            </select>
          </div>

          <!-- Nháº­p thá»§ cÃ´ng -->
          <div id="manualFields">
            <div class="mb-3">
                <label for="client_id" class="form-label">Client ID</label>
                <input type="text" class="form-control" id="client_id" name="client_id">
            </div>
            <div class="mb-3">
                <label for="client_secret" class="form-label">Client Secret</label>
                <input type="text" class="form-control" id="client_secret" name="client_secret">
            </div>
          </div>

          <!-- Upload file -->
          <div id="fileField" class="d-none">
            <div class="mb-3">
                <label for="client_file" class="form-label">Chá»n file client_secret.json</label>
                <input type="file" class="form-control" id="client_file" name="client_file" accept=".json">
            </div>
          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Há»§y</button>
          <button type="submit" class="btn btn-primary">Báº¯t Ä‘áº§u káº¿t ná»‘i</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
function toggleAuthMethod() {
    const method = document.getElementById("authMethod").value;
    document.getElementById("manualFields").classList.toggle("d-none", method !== "manual");
    document.getElementById("fileField").classList.toggle("d-none", method !== "file");
}
</script>
{% endblock %}
